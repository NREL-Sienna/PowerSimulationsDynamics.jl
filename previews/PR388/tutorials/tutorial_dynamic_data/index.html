<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Create Dynamic Data · PowerSimulationsDynamics.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="PowerSimulationsDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PowerSimulationsDynamics.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><a class="tocitem" href="../../quick_start_guide/">Quick Start Guide</a></li><li><a class="tocitem" href="../../execute/">Simulation Execution</a></li><li><span class="tocitem">Tutorials</span><ul><li class="is-active"><a class="tocitem" href>Create Dynamic Data</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#System-description"><span>System description</span></a></li><li><a class="tocitem" href="#Three-Bus-case-manual-data-creation"><span>Three Bus case manual data creation</span></a></li><li><a class="tocitem" href="#Static-System-creation"><span>Static System creation</span></a></li><li><a class="tocitem" href="#Dynamic-Lines-case:-Data-creation"><span>Dynamic Lines case: Data creation</span></a></li><li><a class="tocitem" href="#Dynamic-Inverter-definition"><span>Dynamic Inverter definition</span></a></li><li><a class="tocitem" href="#Dynamic-Generator-definition"><span>Dynamic Generator definition</span></a></li><li><a class="tocitem" href="#Add-the-components-to-the-system"><span>Add the components to the system</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_omib/">OMIB</a></li><li><a class="tocitem" href="../tutorial_dynamic_lines/">Dynamic Lines Simulation</a></li><li><a class="tocitem" href="../tutorial_inverter_modeling/">Inverter Modeling</a></li><li><a class="tocitem" href="../tutorial_240bus/">240 WECC solver comparison</a></li><li><a class="tocitem" href="../tutorial_continuation_pf/">Small-Signal Analysis</a></li><li><a class="tocitem" href="../tutorial_activeload/">Active Load Model</a></li></ul></li><li><a class="tocitem" href="../../models/">Models</a></li><li><a class="tocitem" href="../../initialization/">Initialization</a></li><li><a class="tocitem" href="../../small/">Small Signal</a></li><li><a class="tocitem" href="../../reference_frames/">Reference Frames</a></li><li><a class="tocitem" href="../../perturbations/">Perturbations</a></li><li><a class="tocitem" href="../../time_delays/">Time Delays</a></li><li><a class="tocitem" href="../../generic/">Industrial Renewable Models</a></li><li><span class="tocitem">Generator Component Library</span><ul><li><a class="tocitem" href="../../component_models/machines/">Machine</a></li><li><a class="tocitem" href="../../component_models/shafts/">Shaft</a></li><li><a class="tocitem" href="../../component_models/avr/">AVR</a></li><li><a class="tocitem" href="../../component_models/pss/">PSS</a></li><li><a class="tocitem" href="../../component_models/turbine_gov/">Turbine and Governor</a></li></ul></li><li><span class="tocitem">CIG Component Library</span><ul><li><a class="tocitem" href="../../component_models/converter/">Converter</a></li><li><a class="tocitem" href="../../component_models/dc_source/">DC Sources</a></li><li><a class="tocitem" href="../../component_models/filters/">Filter</a></li><li><a class="tocitem" href="../../component_models/freq_esti/">Frequency Estimators</a></li><li><a class="tocitem" href="../../component_models/inner_control/">Inner Control</a></li><li><a class="tocitem" href="../../component_models/outer_control/">Outer Control</a></li></ul></li><li><span class="tocitem">Branch Models</span><ul><li><a class="tocitem" href="../../component_models/network/">Network</a></li></ul></li><li><span class="tocitem">Load Models</span><ul><li><a class="tocitem" href="../../component_models/loads/">Load Models</a></li></ul></li><li><span class="tocitem">Code Base Developer Guide</span><ul><li><a class="tocitem" href="../../code_base_developer_guide/developer/">Developer Guide</a></li></ul></li><li><a class="tocitem" href="../../api/public/">Public API Reference</a></li><li><a class="tocitem" href="../../api/internal/">Internal API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Create Dynamic Data</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Create Dynamic Data</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-Sienna/PowerSimulationsDynamics.jl/blob/main/docs/src/tutorials/tutorial_dynamic_data.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Creating-and-Handling-Data-for-Dynamic-Simulations"><a class="docs-heading-anchor" href="#Creating-and-Handling-Data-for-Dynamic-Simulations">Creating and Handling Data for Dynamic Simulations</a><a id="Creating-and-Handling-Data-for-Dynamic-Simulations-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-and-Handling-Data-for-Dynamic-Simulations" title="Permalink"></a></h1><p><strong>Originally Contributed by</strong>: Rodrigo Henriquez and José Daniel Lara</p><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>This tutorial briefly introduces how to create a system using <code>PowerSystems.jl</code> data structures. For more details visit <a href="https://nrel-sienna.github.io/PowerSystems.jl/stable/"><code>PowerSystems.jl</code> Documentation</a></p><p>Start by calling <code>PowerSystems.jl</code> and <code>PowerSystemCaseBuilder.jl</code>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using PowerSystems</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; using PowerSystemCaseBuilder</code><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; const PSY = PowerSystems;</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p><code>PowerSystemCaseBuilder.jl</code> is a helper library that makes it easier to reproduce examples in the documentation and tutorials. Normally you would pass your local files to create the system data instead of calling the function <code>build_system</code>. For more details visit <a href="https://nrel-sienna.github.io/PowerSystems.jl/stable/tutorials/powersystembuilder/">PowerSystemCaseBuilder Documentation</a></p></div></div><h2 id="System-description"><a class="docs-heading-anchor" href="#System-description">System description</a><a id="System-description-1"></a><a class="docs-heading-anchor-permalink" href="#System-description" title="Permalink"></a></h2><p>Next we need to define the different elements required to run a simulation. To run a simulation in <code>PowerSimulationsDynamics</code>, it is required to define a <code>System</code> that contains the following components:</p><h3 id="Static-Components"><a class="docs-heading-anchor" href="#Static-Components">Static Components</a><a id="Static-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Static-Components" title="Permalink"></a></h3><p>We called static components to those that are used to run a Power Flow problem.</p><ul><li>Vector of <code>Bus</code> elements, that define all the buses in the network.</li><li>Vector of <code>Branch</code> elements, that define all the branches elements (that connect two buses) in the network.</li><li>Vector of <code>StaticInjection</code> elements, that define all the devices connected to buses that can inject (or withdraw) power. These static devices, typically generators, in <code>PowerSimulationsDynamics</code> are used to solve the Power Flow problem that determines the active and reactive power provided for each device.</li><li>Vector of <code>PowerLoad</code> elements, that define all the loads connected to buses that can withdraw current. These are also used to solve the Power Flow.</li><li>Vector of <code>Source</code> elements, that define source components behind a reactance that can inject or withdraw current.</li><li>The base of power used to define per unit values, in MVA as a <code>Float64</code> value.</li><li>The base frequency used in the system, in Hz as a <code>Float64</code> value.</li></ul><h3 id="Dynamic-Components"><a class="docs-heading-anchor" href="#Dynamic-Components">Dynamic Components</a><a id="Dynamic-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Components" title="Permalink"></a></h3><p>Dynamic components are those that define differential equations to run a transient simulation.</p><ul><li>Vector of <code>DynamicInjection</code> elements. These components must be attached to a <code>StaticInjection</code> that connects the power flow solution to the dynamic formulation of such device. <code>DynamicInjection</code> can be <code>DynamicGenerator</code> or <code>DynamicInverter</code>, and its specific formulation (i.e. differential equations) will depend on the specific components that define such device.</li><li>(Optional) Selecting which of the <code>Lines</code> (of the <code>Branch</code> vector) elements must be modeled of <code>DynamicLines</code> elements, that can be used to model lines with differential equations.</li></ul><p>To start we will define the data structures for the network.</p><h2 id="Three-Bus-case-manual-data-creation"><a class="docs-heading-anchor" href="#Three-Bus-case-manual-data-creation">Three Bus case manual data creation</a><a id="Three-Bus-case-manual-data-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Three-Bus-case-manual-data-creation" title="Permalink"></a></h2><p>The following describes the system creation for this dynamic simulation case.</p><h2 id="Static-System-creation"><a class="docs-heading-anchor" href="#Static-System-creation">Static System creation</a><a id="Static-System-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Static-System-creation" title="Permalink"></a></h2><p>To create the system you need to load data using <code>PowerSystemCaseBuilder.jl</code>. This system was originally created from following <a href="https://github.com/NREL-Sienna/PowerSystemsTestData/blob/master/psid_tests/data_tests/ThreeBusInverter.raw">raw file</a>.  </p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; sys = build_system(PSIDSystems, &quot;3 Bus Inverter Base&quot;; force_build=true)</code><code class="nohighlight hljs ansi" style="display:block;">System
┌───────────────────┬─────────────┐
│ Property          │ Value       │
├───────────────────┼─────────────┤
│ Name              │             │
│ Description       │             │
│ System Units Base │ SYSTEM_BASE │
│ Base Power        │ 100.0       │
│ Base Frequency    │ 60.0        │
│ Num Components    │ 16          │
└───────────────────┴─────────────┘

Static Components
┌─────────────────┬───────┐
│ Type            │ Count │
├─────────────────┼───────┤
│ ACBus           │ 3     │
│ Arc             │ 3     │
│ Area            │ 1     │
│ Line            │ 3     │
│ LoadZone        │ 1     │
│ StandardLoad    │ 3     │
│ ThermalStandard │ 2     │
└─────────────────┴───────┘</code></pre><p>This system does not have an injection device in bus 1 (the reference bus). We can add a source with small impedance directly as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; slack_bus = [b for b in get_components(ACBus, sys) if get_bustype(b) == ACBusTypes.REF][1]</code><code class="nohighlight hljs ansi" style="display:block;">ACBus: BUS 1:
   number: 101
   name: BUS 1
   bustype: ACBusTypes.REF = 3
   angle: 0.0
   magnitude: 1.02
   voltage_limits: (min = 0.9, max = 1.1)
   base_voltage: 138.0
   area: Area: 1
   load_zone: LoadZone: 1
   ext: Dict{String, Any}()
   InfrastructureSystems.SystemUnitsSettings:
      base_value: 100.0
      unit_system: UnitSystem.SYSTEM_BASE = 0
   has_supplemental_attributes: false
   has_time_series: false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; inf_source = Source(
           name = &quot;InfBus&quot;, #name
           available = true, #availability
           active_power = 0.0,
           reactive_power = 0.0,
           bus = slack_bus, #bus
           R_th = 0.0, #Rth
           X_th = 5e-6, #Xth
       )</code><code class="nohighlight hljs ansi" style="display:block;">
Source: InfBus:
   name: InfBus
   available: true
   bus: ACBus: BUS 1
   active_power: 0.0
   reactive_power: 0.0
   R_th: 0.0
   X_th: 5.0e-6
   internal_voltage: 1.0
   internal_angle: 0.0
   base_power: 100.0
   dynamic_injector: nothing
   services: 0-element Vector{Service}
   ext: Dict{String, Any}()
   internal: InfrastructureSystems.InfrastructureSystemsInternal
   has_supplemental_attributes: false
   has_time_series: false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_component!(sys, inf_source)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>We just added a infinite source with <span>$X_{th} = 5\cdot 10^{-6}$</span> pu. The system can be explored directly using functions like:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; show_components(sys, Source)</code><code class="nohighlight hljs ansi" style="display:block;">Source
┌────────┬───────────┐
│ name   │ available │
├────────┼───────────┤
│ InfBus │ true      │
└────────┴───────────┘</code></pre><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; show_components(sys, ThermalStandard)</code><code class="nohighlight hljs ansi" style="display:block;">ThermalStandard
┌─────────────────┬───────────┐
│ name            │ available │
├─────────────────┼───────────┤
│ generator-102-1 │ true      │
│ generator-103-1 │ true      │
└─────────────────┴───────────┘</code></pre><p>By exploring those it can be seen that the generators are named as: <code>generator-bus_number-id</code>. Then, the generator attached at bus 2 is named <code>generator-102-1</code>.</p><h3 id="Dynamic-Injections"><a class="docs-heading-anchor" href="#Dynamic-Injections">Dynamic Injections</a><a id="Dynamic-Injections-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Injections" title="Permalink"></a></h3><p>We are now interested in attaching to the system the dynamic component that will be modeling our dynamic generator.</p><p>Dynamic generator devices are composed by 5 components, namely, <code>machine</code>, <code>shaft</code>, <code>avr</code>, <code>tg</code> and <code>pss</code>. So we will be adding functions to create all of its components and the generator itself:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; # *Machine*
       machine_classic() = BaseMachine(
           0.0, #R
           0.2995, #Xd_p
           0.7087, #eq_p
       )
       
       # *Shaft*</code><code class="nohighlight hljs ansi" style="display:block;">machine_classic (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shaft_damping() = SingleMass(
           3.148, #H
           2.0, #D
       )
       
       # *AVR: No AVR*</code><code class="nohighlight hljs ansi" style="display:block;">shaft_damping (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; avr_none() = AVRFixed(0.0)
       
       # *TG: No TG*</code><code class="nohighlight hljs ansi" style="display:block;">avr_none (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tg_none() = TGFixed(1.0) #efficiency
       
       # *PSS: No PSS*</code><code class="nohighlight hljs ansi" style="display:block;">tg_none (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pss_none() = PSSFixed(0.0)</code><code class="nohighlight hljs ansi" style="display:block;">pss_none (generic function with 1 method)</code></pre><p>The next lines receives a static generator name, and creates a <code>DynamicGenerator</code> based on that specific static generator, with the specific components defined previously. This is a classic machine model without AVR, Turbine Governor and PSS.</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; static_gen = get_component(Generator, sys, &quot;generator-102-1&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">ThermalStandard: generator-102-1:
   name: generator-102-1
   available: true
   status: true
   bus: ACBus: BUS 2
   active_power: 0.7
   reactive_power: 0.0
   rating: 3.333526661060325
   active_power_limits: (min = 0.0, max = 3.18)
   reactive_power_limits: (min = -1.0, max = 1.0)
   ramp_limits: (up = 3.18, down = 3.18)
   operation_cost: ThermalGenerationCost composed of variable: CostCurve{QuadraticCurve}
   base_power: 100.0
   time_limits: nothing
   must_run: false
   prime_mover_type: PrimeMovers.OT = 19
   fuel: ThermalFuels.OTHER = 14
   services: 0-element Vector{Service}
   time_at_status: 10000.0
   dynamic_injector: nothing
   ext: Dict{String, Any}(&quot;z_source&quot; =&gt; (r = 0.0, x = 1.0))
   InfrastructureSystems.SystemUnitsSettings:
      base_value: 100.0
      unit_system: UnitSystem.SYSTEM_BASE = 0
   has_supplemental_attributes: false
   has_time_series: false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dyn_gen = DynamicGenerator(
           name = get_name(static_gen),
           ω_ref = 1.0,
           machine = machine_classic(),
           shaft = shaft_damping(),
           avr = avr_none(),
           prime_mover = tg_none(),
           pss = pss_none(),
       )</code><code class="nohighlight hljs ansi" style="display:block;">
DynamicGenerator: generator-102-1:
   name: generator-102-1
   ω_ref: 1.0
   machine: BaseMachine
   shaft: SingleMass
   avr: AVRFixed
   prime_mover: TGFixed
   pss: PSSFixed
   base_power: 100.0
   n_states: 2
   states: [:δ, :ω]
   ext: Dict{String, Any}()
   internal: InfrastructureSystems.InfrastructureSystemsInternal
   has_supplemental_attributes: false
   has_time_series: false</code></pre><p>The dynamic generator is added to the system by specifying the dynamic and static generator</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_component!(sys, dyn_gen, static_gen)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Then we can serialize our system data to a json file that can be later read as:</p><pre><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; to_json(sys, joinpath(file_dir, &quot;modified_sys.json&quot;), force = true)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h2 id="Dynamic-Lines-case:-Data-creation"><a class="docs-heading-anchor" href="#Dynamic-Lines-case:-Data-creation">Dynamic Lines case: Data creation</a><a id="Dynamic-Lines-case:-Data-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Lines-case:-Data-creation" title="Permalink"></a></h2><p>We will now create a three bus system with one inverter and one generator. In order to do so, we will parse the following <code>ThreebusInverter.raw</code> network:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; threebus_sys = build_system(PSIDSystems, &quot;3 Bus Inverter Base&quot;)</code><code class="nohighlight hljs ansi" style="display:block;">System
┌───────────────────┬─────────────┐
│ Property          │ Value       │
├───────────────────┼─────────────┤
│ Name              │             │
│ Description       │             │
│ System Units Base │ SYSTEM_BASE │
│ Base Power        │ 100.0       │
│ Base Frequency    │ 60.0        │
│ Num Components    │ 16          │
└───────────────────┴─────────────┘

Static Components
┌─────────────────┬───────┐
│ Type            │ Count │
├─────────────────┼───────┤
│ ACBus           │ 3     │
│ Arc             │ 3     │
│ Area            │ 1     │
│ Line            │ 3     │
│ LoadZone        │ 1     │
│ StandardLoad    │ 3     │
│ ThermalStandard │ 2     │
└─────────────────┴───────┘</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; slack_bus = first(get_components(x -&gt; get_bustype(x) == BusTypes.REF, Bus, threebus_sys))</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: UndefVarError: `BusTypes` not defined</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; inf_source = Source(
           name = &quot;InfBus&quot;, #name
           available = true, #availability
           active_power = 0.0,
           reactive_power = 0.0,
           bus = slack_bus, #bus
           R_th = 0.0, #Rth
           X_th = 5e-6, #Xth
       )</code><code class="nohighlight hljs ansi" style="display:block;">
Source: InfBus:
   name: InfBus
   available: true
   bus: ACBus: BUS 1
   active_power: 0.0
   reactive_power: 0.0
   R_th: 0.0
   X_th: 5.0e-6
   internal_voltage: 1.0
   internal_angle: 0.0
   base_power: 100.0
   dynamic_injector: nothing
   services: 0-element Vector{Service}
   ext: Dict{String, Any}()
   internal: InfrastructureSystems.InfrastructureSystemsInternal
   has_supplemental_attributes: false
   has_time_series: false</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; add_component!(threebus_sys, inf_source)</code><code class="nohighlight hljs ansi" style="display:block;">ERROR: ArgumentError: ACBus: BUS 1 is not attached to the system</code></pre><p>We will connect a One-d-one-q machine at bus 102, and a Virtual Synchronous Generator Inverter at bus 103. An inverter is composed by a <code>converter</code>, <code>outer control</code>, <code>inner control</code>, <code>dc source</code>, <code>frequency estimator</code> and a <code>filter</code>.</p><h2 id="Dynamic-Inverter-definition"><a class="docs-heading-anchor" href="#Dynamic-Inverter-definition">Dynamic Inverter definition</a><a id="Dynamic-Inverter-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Inverter-definition" title="Permalink"></a></h2><p>We will create specific functions to create the components of the inverter as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; #Define converter as an AverageConverter
       converter_high_power() = AverageConverter(
           rated_voltage = 138.0,
           rated_current = 100.0
           )
       
       #Define Outer Control as a composition of Virtual Inertia + Reactive Power Droop</code><code class="nohighlight hljs ansi" style="display:block;">converter_high_power (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; outer_control() = OuterControl(
           VirtualInertia(Ta = 2.0, kd = 400.0, kω = 20.0),
           ReactivePowerDroop(kq = 0.2, ωf = 1000.0),
       )
       
       #Define an Inner Control as a Voltage+Current Controler with Virtual Impedance:</code><code class="nohighlight hljs ansi" style="display:block;">outer_control (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; inner_control() = VoltageModeControl(
           kpv = 0.59,     #Voltage controller proportional gain
           kiv = 736.0,    #Voltage controller integral gain
           kffv = 0.0,     #Binary variable enabling voltage feed-forward in current controllers
           rv = 0.0,       #Virtual resistance in pu
           lv = 0.2,       #Virtual inductance in pu
           kpc = 1.27,     #Current controller proportional gain
           kic = 14.3,     #Current controller integral gain
           kffi = 0.0,     #Binary variable enabling the current feed-forward in output of current controllers
           ωad = 50.0,     #Active damping low pass filter cut-off frequency
           kad = 0.2,      #Active damping gain
       )
       
       #Define DC Source as a FixedSource:</code><code class="nohighlight hljs ansi" style="display:block;">inner_control (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; dc_source_lv() = FixedDCSource(voltage = 600.0)
       
       #Define a Frequency Estimator as a PLL
       #based on Vikram Kaura and Vladimir Blaskoc 1997 paper:</code><code class="nohighlight hljs ansi" style="display:block;">dc_source_lv (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pll() = KauraPLL(
           ω_lp = 500.0, #Cut-off frequency for LowPass filter of PLL filter.
           kp_pll = 0.084,  #PLL proportional gain
           ki_pll = 4.69,   #PLL integral gain
       )
       
       #Define an LCL filter:</code><code class="nohighlight hljs ansi" style="display:block;">pll (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; filt() = LCLFilter(lf = 0.08, rf = 0.003, cf = 0.074, lg = 0.2, rg = 0.01)</code><code class="nohighlight hljs ansi" style="display:block;">filt (generic function with 1 method)</code></pre><p>We will construct the inverter later by specifying to which static device is assigned.</p><h2 id="Dynamic-Generator-definition"><a class="docs-heading-anchor" href="#Dynamic-Generator-definition">Dynamic Generator definition</a><a id="Dynamic-Generator-definition-1"></a><a class="docs-heading-anchor-permalink" href="#Dynamic-Generator-definition" title="Permalink"></a></h2><p>Similarly we will construct a dynamic generator as follows:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; # Create the machine
       machine_oneDoneQ() = OneDOneQMachine(
           0.0, #R
           1.3125, #Xd
           1.2578, #Xq
           0.1813, #Xd_p
           0.25, #Xq_p
           5.89, #Td0_p
           0.6, #Tq0_p
       )
       
       # Shaft</code><code class="nohighlight hljs ansi" style="display:block;">machine_oneDoneQ (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; shaft_no_damping() = SingleMass(
           3.01, #H (M = 6.02 -&gt; H = M/2)
           0.0, #D
       )
       
       # AVR: Type I: Resembles a DC1 AVR</code><code class="nohighlight hljs ansi" style="display:block;">shaft_no_damping (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; avr_type1() = AVRTypeI(
           20.0, #Ka - Gain
           0.01, #Ke
           0.063, #Kf
           0.2, #Ta
           0.314, #Te
           0.35, #Tf
           0.001, #Tr
           (min = -5.0, max = 5.0),
           0.0039, #Ae - 1st ceiling coefficient
           1.555, #Be - 2nd ceiling coefficient
       )
       
       #No TG</code><code class="nohighlight hljs ansi" style="display:block;">avr_type1 (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; tg_none() = TGFixed(1.0) #efficiency
       
       #No PSS</code><code class="nohighlight hljs ansi" style="display:block;">tg_none (generic function with 1 method)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; pss_none() = PSSFixed(0.0) #Vs</code><code class="nohighlight hljs ansi" style="display:block;">pss_none (generic function with 1 method)</code></pre><p>Now we will construct the dynamic generator and inverter.</p><h2 id="Add-the-components-to-the-system"><a class="docs-heading-anchor" href="#Add-the-components-to-the-system">Add the components to the system</a><a id="Add-the-components-to-the-system-1"></a><a class="docs-heading-anchor-permalink" href="#Add-the-components-to-the-system" title="Permalink"></a></h2><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; for g in get_components(Generator, threebus_sys)
           #Find the generator at bus 102
           if get_number(get_bus(g)) == 102
               #Create the dynamic generator
               case_gen = DynamicGenerator(
                   get_name(g),
                   1.0, # ω_ref,
                   machine_oneDoneQ(), #machine
                   shaft_no_damping(), #shaft
                   avr_type1(), #avr
                   tg_none(), #tg
                   pss_none(), #pss
               )
               #Attach the dynamic generator to the system by
               # specifying the dynamic and static components
               add_component!(threebus_sys, case_gen, g)
               #Find the generator at bus 103
           elseif get_number(get_bus(g)) == 103
               #Create the dynamic inverter
               case_inv = DynamicInverter(
                   get_name(g),
                   1.0, # ω_ref,
                   converter_high_power(), #converter
                   outer_control(), #outer control
                   inner_control(), #inner control voltage source
                   dc_source_lv(), #dc source
                   pll(), #pll
                   filt(), #filter
               )
               #Attach the dynamic inverter to the system
               add_component!(threebus_sys, case_inv, g)
           end
       end</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><h3 id="Save-the-system-in-a-JSON-file"><a class="docs-heading-anchor" href="#Save-the-system-in-a-JSON-file">Save the system in a JSON file</a><a id="Save-the-system-in-a-JSON-file-1"></a><a class="docs-heading-anchor-permalink" href="#Save-the-system-in-a-JSON-file" title="Permalink"></a></h3><pre><code class="nohighlight hljs ansi" style="display:block;"></code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; to_json(threebus_sys, joinpath(file_dir, &quot;threebus_sys.json&quot;), force = true)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../execute/">« Simulation Execution</a><a class="docs-footer-nextpage" href="../tutorial_omib/">OMIB »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Thursday 5 September 2024 17:52">Thursday 5 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
