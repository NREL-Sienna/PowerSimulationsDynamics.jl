<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Inner Control · PowerSimulationsDynamics.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="PowerSimulationsDynamics.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PowerSimulationsDynamics.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Welcome Page</a></li><li><a class="tocitem" href="../../quick_start_guide/">Quick Start Guide</a></li><li><a class="tocitem" href="../../tutorials_page/">Tutorials</a></li><li><a class="tocitem" href="../../models/">Models</a></li><li><a class="tocitem" href="../../initialization/">Initialization</a></li><li><a class="tocitem" href="../../small/">Small Signal</a></li><li><a class="tocitem" href="../../reference_frames/">Reference Frames</a></li><li><span class="tocitem">Generator Component Library</span><ul><li><a class="tocitem" href="../machines/">Machine</a></li><li><a class="tocitem" href="../shafts/">Shaft</a></li><li><a class="tocitem" href="../avr/">AVR</a></li><li><a class="tocitem" href="../pss/">PSS</a></li><li><a class="tocitem" href="../turbine_gov/">Turbine and Governor</a></li></ul></li><li><span class="tocitem">CIG Component Library</span><ul><li><a class="tocitem" href="../converter/">Converter</a></li><li><a class="tocitem" href="../dc_source/">DC Sources</a></li><li><a class="tocitem" href="../filters/">Filter</a></li><li><a class="tocitem" href="../freq_esti/">Frequency Estimators</a></li><li class="is-active"><a class="tocitem" href>Inner Control</a><ul class="internal"><li><a class="tocitem" href="#Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[VoltageModeControl]"><span>Integrated Virtual Impedance, Voltage and Current Controller <code>[VoltageModeControl]</code></span></a></li><li><a class="tocitem" href="#Current-Mode-Controller-[CurrentModeControl]"><span>Current Mode Controller <code>[CurrentModeControl]</code></span></a></li></ul></li><li><a class="tocitem" href="../outer_control/">Outer Control</a></li></ul></li><li><span class="tocitem">Branch Models</span><ul><li><a class="tocitem" href="../network/">Network</a></li></ul></li><li><span class="tocitem">Code Base Developer Guide</span><ul><li><a class="tocitem" href="../../code_base_developer_guide/developer/">Developer Guide</a></li></ul></li><li><a class="tocitem" href="../../api/public/">Public API Reference</a></li><li><a class="tocitem" href="../../api/internal/">Internal API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">CIG Component Library</a></li><li class="is-active"><a href>Inner Control</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Inner Control</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/NREL-SIIP/PowerSimulationsDynamics.jl/blob/master/docs/src/component_models/inner_control.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Inner-Loop-Controls"><a class="docs-heading-anchor" href="#Inner-Loop-Controls">Inner Loop Controls</a><a id="Inner-Loop-Controls-1"></a><a class="docs-heading-anchor-permalink" href="#Inner-Loop-Controls" title="Permalink"></a></h1><p>This component defines voltage and current controllers to generate the reference signal for the converter. Although in many controls the current and voltage control are separate blocks we propose a more general control approach that considers them as a joint control logic.</p><h2 id="Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[VoltageModeControl]"><a class="docs-heading-anchor" href="#Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[VoltageModeControl]">Integrated Virtual Impedance, Voltage and Current Controller <code>[VoltageModeControl]</code></a><a id="Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[VoltageModeControl]-1"></a><a class="docs-heading-anchor-permalink" href="#Integrated-Virtual-Impedance,-Voltage-and-Current-Controller-[VoltageModeControl]" title="Permalink"></a></h2><p>The following model receives both the outer loop control frequency and reference voltage signal to generate the reference signal for the converters. The virtual impedance plays a similar role of the impedance of a synchronous generator. A PI voltage controller is used to generate the current signal that is used in the PI current controller to finally generate the voltage reference signal for the converters.</p><p class="math-container">\[\begin{align*}
    \dot{\xi}_d &amp;= v_{d,\text{vi}}^{\text{ref}} - v_d \tag{1a} \\
    \dot{\xi}_q &amp;= v_{q,\text{vi}}^{\text{ref}} - v_q \tag{1b} \\
    \dot{\gamma}_d &amp;= i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}} \tag{1c} \\
    \dot{\gamma}_q &amp;= i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}} \tag{1d} \\
    \dot{\phi}_d &amp;= \omega_{\text{ad}}(v_d - \phi_d) \tag{1e} \\
    \dot{\phi}_q &amp;= \omega_{\text{ad}}(v_q - \phi_q) \tag{1f}
\end{align*}\]</p><p>with</p><p class="math-container">\[\begin{align}
    v_{d,\text{vi}}^{\text{ref}} &amp;= v_{\text{olc}}^{\text{ref}} - r_v i_d + \omega_{\text{olc}} l_v i_q \tag{1g} \\
    v_{q,\text{vi}}^{\text{ref}} &amp;= - r_v i_q - \omega_{\text{olc}} l_v i_d \tag{1h} \\
    i_{d,\text{cv}}^{\text{ref}} &amp;= k_{pv}\left(v_{d,\text{vi}}^{\text{ref}} - v_d\right) + k_{iv} \xi_d - c_f \omega_{\text{olc}} v_q + k_{\text{ffi}}i_d \tag{1i} \\
    i_{q,\text{cv}}^{\text{ref}} &amp;= k_{pv}\left(v_{q,\text{vi}}^{\text{ref}} - v_q\right) + k_{iv} \xi_q + c_f \omega_{\text{olc}} v_d + k_{\text{ffi}}i_q \tag{1j} \\
    v_d^{\text{ref-signal}} &amp;= k_{pc} \left(i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}}\right) + k_{ic} \gamma_d - \omega_{\text{olc}} l_f i_{q,\text{cv}} + k_{\text{ffv}}v_d - k_{\text{ad}}(v_d - \phi_d) \tag{1k} \\
    v_q^{\text{ref-signal}} &amp;= k_{pc} \left(i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}}\right) + k_{ic} \gamma_q + \omega_{\text{olc}} l_f i_{d,\text{cv}} + k_{\text{ffv}}v_q - k_{\text{ad}}(v_q - \phi_q) \tag{1l}
\end{align}\]</p><p>In here the transformation to the <span>$dq$</span> reference frame is using the outer-loop reference angle as:</p><p class="math-container">\[\begin{align*}
v_d + jv_q = (v_r + jv_i)e^{-j\delta\theta_{olc}} \\
i_d + ji_q = (i_r + ji_i)e^{-j\delta\theta_{olc}}
\end{align*}\]</p><p>that again <span>$v_r + jv_i$</span> could be in the capacitor or the last branch of the filter (i.e. the point of common coupling). For LCL filters it is considered in the capacitor. In the case of the converter, the transformation is directly</p><p class="math-container">\[\begin{align*}
i_{d,\text{cv}} + ji_{q,\text{cv}} = (i_{r,\text{cv}} + ji_{i,\text{cv}})e^{-j\delta\theta_{olc}}
\end{align*}\]</p><h2 id="Current-Mode-Controller-[CurrentModeControl]"><a class="docs-heading-anchor" href="#Current-Mode-Controller-[CurrentModeControl]">Current Mode Controller <code>[CurrentModeControl]</code></a><a id="Current-Mode-Controller-[CurrentModeControl]-1"></a><a class="docs-heading-anchor-permalink" href="#Current-Mode-Controller-[CurrentModeControl]" title="Permalink"></a></h2><p>The following model receives the current reference (in <span>$dq$</span> axis) from an outer loop controller that outputs current references such as the PI outer controller used for grid following inverters. A PI current controller is used to generate the voltage reference signal for the converters.</p><p class="math-container">\[\begin{align*}
    \dot{\gamma}_d &amp;= i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}} \tag{2a} \\
    \dot{\gamma}_q &amp;= i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}} \tag{2b} \\
\end{align*}\]</p><p>with</p><p class="math-container">\[\begin{align}
    v_d^{\text{ref-signal}} &amp;= k_{pc} \left(i_{d,\text{cv}}^{\text{ref}} - i_{d,\text{cv}}\right) + k_{ic} \gamma_d - \omega_{\text{olc}} l_f i_{q,\text{cv}} + k_{\text{ffv}}v_d \tag{2b} \\
    v_q^{\text{ref-signal}} &amp;= k_{pc} \left(i_{q,\text{cv}}^{\text{ref}} - i_{q,\text{cv}}\right) + k_{ic} \gamma_q + \omega_{\text{olc}} l_f i_{d,\text{cv}} + k_{\text{ffv}}v_q \tag{2c}
\end{align}\]</p><p>The transformation for the converter current is computed as:</p><p class="math-container">\[\begin{align*}
i_{d,\text{cv}} + ji_{q,\text{cv}} = (i_{r,\text{cv}} + ji_{i,\text{cv}})e^{-j\theta_{olc}}
\end{align*}\]</p><p>In here <span>$\theta_{olc}$</span> is the outer-loop angle. In the case of grid-following models, this angle is equal to the angle provided from the PLL.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../freq_esti/">« Frequency Estimators</a><a class="docs-footer-nextpage" href="../outer_control/">Outer Control »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 18 June 2021 22:04">Friday 18 June 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
